<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploy to Netlify</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f7fc; margin: 0; padding: 0; }
        header { background-color: #333; color: white; text-align: center; padding: 20px; font-size: 24px; }
        .container { width: 80%; margin: 20px auto; padding: 20px; background-color: #fff; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h2 { text-align: center; color: #333; }
        button { padding: 15px; background-color: #5cb85c; color: white; border: none; cursor: pointer; width: 100%; margin-top: 10px; }
        .repo-selector, .deploy-options { display: none; margin-top: 20px; }
        select, input { padding: 10px; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>
    <header>Deploy Your Repository to Netlify</header>
    <div class="container">
        <h2>Login to Deploy</h2>
        <button id="github-login">Login with GitHub</button>
        <button id="gitlab-login">Login with GitLab</button>

        <div id="repo-selector" class="repo-selector">
            <h3>Select a repository:</h3>
            <select id="repo-list"></select>
            <div class="deploy-options">
                <h3>Deployment Options</h3>
                <input type="text" id="site-name" placeholder="Website Name">
                <input type="text" id="build-command" placeholder="Build Command">
                <input type="text" id="start-command" placeholder="Start Command">
                <button id="deploy-btn">Deploy to Netlify</button>
            </div>
        </div>
        <div id="output-container" class="output-container" style="display:none;">
            <h3>Your Site is Ready!</h3>
            <a id="site-link" href="#" target="_blank">View Your Site</a>
        </div>
    </div>
    
    <script>
        const githubClientId = 'Ov23liDtYx7bM6q4tUbZ';
        const gitlabClientId = '8c5a3a0a0223b89e9b53b88701120c33823e5a34f6f7e1be8932a4beed9b6195';
        const netlifyAccessToken = 'nfp_dxpV2Vqetkh2HKjJi4q875tiEmQB7W4v7d90';
        const netlifyDeployUrl = 'https://api.netlify.com/api/v1/sites';

        document.getElementById('github-login').addEventListener('click', () => {
            window.location.href = `https://github.com/login/oauth/authorize?client_id=${githubClientId}&scope=repo`;
        });

        document.getElementById('gitlab-login').addEventListener('click', () => {
            window.location.href = `https://gitlab.com/oauth/authorize?client_id=${gitlabClientId}&response_type=token&scope=api`;
        });

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('code')) {
            const oauthCode = urlParams.get('code');
            fetch(`/getAccessToken?code=${oauthCode}`)
                .then(res => res.json())
                .then(data => {
                    fetchRepos('github', data.access_token);
                });
        }

        function fetchRepos(service, token) {
            let url = service === 'github' ? 'https://api.github.com/user/repos' : 'https://gitlab.com/api/v4/projects';
            fetch(url, { headers: { Authorization: `Bearer ${token}` } })
            .then(response => response.json())
            .then(repos => {
                const repoList = document.getElementById('repo-list');
                repoList.innerHTML = '';
                repos.forEach(repo => {
                    let option = document.createElement('option');
                    option.value = repo.id;
                    option.textContent = repo.name;
                    repoList.appendChild(option);
                });
                document.getElementById('repo-selector').style.display = 'block';
                document.querySelector('.deploy-options').style.display = 'block';
            });
        }

        document.getElementById('deploy-btn').addEventListener('click', () => {
            const siteName = document.getElementById('site-name').value;
            const buildCmd = document.getElementById('build-command').value;
            const startCmd = document.getElementById('start-command').value;
            
            fetch(netlifyDeployUrl, {
                method: 'POST',
                headers: { Authorization: `Bearer ${netlifyAccessToken}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: siteName, build: buildCmd, start: startCmd })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('site-link').href = data.deploy_url;
                document.getElementById('site-link').textContent = 'View your deployed site';
                document.getElementById('output-container').style.display = 'block';
            });
        });
    </script>
</body>
</html>
